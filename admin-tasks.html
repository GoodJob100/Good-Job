<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Task Management</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@latest/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body class="bg-gray-100 min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-md relative">
      <div class="max-w-7xl mx-auto px-4 py-3 relative flex items-center justify-center">
        <p onclick="window.location.href='/admin.html'" class="absolute left-4 text-gray-700 cursor-pointer">
          <i class="fas fa-arrow-left text-2xl"></i>
        </p>
        <h1 class="text-xl font-bold text-gray-800">Admin Panel</h1>
      </div>
    </header>

    <!-- MAIN -->
    <main class="max-w-4xl mx-auto p-4">

      <!-- Add Task Card -->
      <div class="bg-white rounded-xl shadow-md p-5 mb-6">
        <h2 class="text-lg font-bold mb-4 text-gray-800">âž• Add New Task</h2>

        <div class="space-y-4">
          <input id="title" type="text" placeholder="Task Title"
            class="w-full p-3 border rounded-lg focus:ring focus:ring-blue-200">

          <textarea id="description" rows="3" placeholder="Task Description"
            class="w-full p-3 border rounded-lg focus:ring focus:ring-blue-200"></textarea>

          <input id="url" type="url" placeholder="Task URL (https://...)"
            class="w-full p-3 border rounded-lg focus:ring focus:ring-blue-200">

          <input id="reward" type="number" placeholder="Reward Amount"
            class="w-full p-3 border rounded-lg focus:ring focus:ring-blue-200">

          <button onclick="addTask()"
            class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition">
            Add Task
          </button>
        </div>
      </div>

      <!-- Task List -->
      <div class="bg-white rounded-xl shadow-md p-5">
        <h2 class="text-lg font-bold mb-4 text-gray-800">ðŸ“‹ All Tasks</h2>

        <div id="taskList" class="space-y-3"></div>
      </div>

    </main>

    <!-- Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        doc,
        setDoc,
        deleteDoc,
        onSnapshot
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCkYWvYNsg2-CR88Js6gcP2nXfvwI4TW30",
        authDomain: "bdwork-346d3.firebaseapp.com",
        projectId: "bdwork-346d3",
        storageBucket: "bdwork-346d3.appspot.com",
        messagingSenderId: "900963179093",
        appId: "1:900963179093:web:81e42d67bb31d603cc92dc",
        measurementId: "G-FM1YJ8E5GK",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const taskRef = collection(db, "tasks");

      // Add Task
      window.addTask = async () => {
        const title = document.getElementById("title").value;
        const description = document.getElementById("description").value;
        const url = document.getElementById("url").value;
        const reward = document.getElementById("reward").value;

        if (!title || !description || !reward || !url) {
          Swal.fire("Error", "All fields required", "error");
          return;
        }

        const id = Date.now().toString();

        await setDoc(doc(db, "tasks", id), {
          title,
          description,
          url,
          reward,
          created: new Date()
        });

        Swal.fire("Success", "Task Added", "success");

        document.getElementById("title").value = "";
        document.getElementById("description").value = "";
        document.getElementById("url").value = "";
        document.getElementById("reward").value = "";
      };

      // Load Tasks Live
      onSnapshot(taskRef, (snapshot) => {
        const list = document.getElementById("taskList");
        list.innerHTML = "";

        snapshot.forEach((docSnap) => {
          const t = docSnap.data();

          list.innerHTML += `
            <div class="border p-4 rounded-lg space-y-2">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="font-bold text-gray-800">${t.title}</h3>
                  <p class="text-sm text-gray-600">${t.description}</p>
                  <a href="${t.url}" target="_blank" class="text-blue-600 text-sm underline">${t.url}</a>
                  <p class="text-green-600 font-semibold mt-1">à§³ ${t.reward}</p>
                </div>

                <button onclick="deleteTask('${docSnap.id}')"
                  class="text-red-500 hover:text-red-700 text-xl">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          `;
        });
      });

      // Delete Task
      window.deleteTask = async (id) => {
        const res = await Swal.fire({
          title: "Delete Task?",
          text: "This cannot be undone!",
          icon: "warning",
          showCancelButton: true,
          confirmButtonText: "Yes, Delete"
        });

        if (res.isConfirmed) {
          await deleteDoc(doc(db, "tasks", id));
          Swal.fire("Deleted", "Task Removed", "success");
        }
      };
    </script>

  </body>
</html>
