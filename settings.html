<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Settings</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@latest/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow-md relative">
    <div class="max-w-7xl mx-auto px-4 py-3 relative flex items-center justify-center">
      <!-- Back Icon (left side) -->
      <p onclick="window.location.href='/admin.html'" class="absolute left-4 text-gray-700 cursor-pointer">
        <i class="fas fa-arrow-left text-2xl"></i>
      </p>

      <!-- Centered Title -->
      <h1 class="text-xl font-bold text-gray-800">Admin Panel</h1>
    </div>
  </header>

   <!-- Main Content -->
  <main class="flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-white shadow-lg rounded-md p-6 sm:p-8 mt-10">
      <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Settings</h2>

      <form class="space-y-4">
        <!-- Referral Bonus -->
        <div>
          <label class="block text-gray-700 font-medium mb-1" for="referralBonusInput">Referral Bonus (৳)</label>
          <input id="referralBonusInput" type="number" min="0" step="0.01"
            class="w-full border border-gray-400 rounded-md px-4 py-2 outline-none" value="0" />
        </div>

        <!-- Minimum Withdraw -->
        <div>
          <label class="block text-gray-700 font-medium mb-1" for="minWithdrawInput">Minimum Withdraw (৳)</label>
          <input id="minWithdrawInput" type="number" min="0" step="0.01"
            class="w-full border border-gray-400 rounded-md px-4 py-2 outline-none" value="0" />
        </div>

        <!-- Minimum Deposit -->
        <div>
          <label class="block text-gray-700 font-medium mb-1" for="minDepositInput">Minimum Deposit (৳)</label>
          <input id="minDepositInput" type="number" min="0" step="0.01"
            class="w-full border border-gray-400 rounded-md px-4 py-2 outline-none" value="0" />
        </div>
      </form>

      <div class="mt-6">
        <p id="updateSettingsBtn"
          class="w-full bg-blue-600 text-white text-center font-semibold py-2 px-4 rounded-md cursor-pointer">
          <i class="fas fa-save mr-2"></i>Update Settings
        </p>
      </div>
      <p id="settingsStatus" class="text-sm mt-4 text-gray-700 text-center sm:text-left"></p>
    </div>
  </main>

<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCkYWvYNsg2-CR88Js6gcP2nXfvwI4TW30",
    authDomain: "bdwork-346d3.firebaseapp.com",
    projectId: "bdwork-346d3",
    storageBucket: "bdwork-346d3.appspot.com",
    messagingSenderId: "900963179093",
    appId: "1:900963179093:web:81e42d67bb31d603cc92dc",
    measurementId: "G-FM1YJ8E5GK"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // Load Settings
  async function loadSettings() {
    try {
      const referSnap = await getDoc(doc(db, "settings", "referralBonus"));
      if (referSnap.exists()) {
        document.getElementById("referralBonusInput").value = referSnap.data().value || 0;
      }

      const withdrawSnap = await getDoc(doc(db, "settings", "minWithdraw"));
      if (withdrawSnap.exists()) {
        document.getElementById("minWithdrawInput").value = withdrawSnap.data().value || 0;
      }

      const depositSnap = await getDoc(doc(db, "settings", "minDeposit"));
      if (depositSnap.exists()) {
        document.getElementById("minDepositInput").value = depositSnap.data().value || 0;
      }
    } catch (error) {
      console.error("Error loading settings:", error);
      document.getElementById("settingsStatus").textContent = "Error loading settings.";
    }
  }

  // Update Settings (each one in its own document)
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("updateSettingsBtn").addEventListener("click", async () => {
      const newBonus = parseFloat(document.getElementById("referralBonusInput").value);
      const newMinWithdraw = parseFloat(document.getElementById("minWithdrawInput").value);
      const newMinDeposit = parseFloat(document.getElementById("minDepositInput").value);

      if (isNaN(newBonus) || newBonus < 0 || isNaN(newMinWithdraw) || newMinWithdraw < 0 || isNaN(newMinDeposit) || newMinDeposit < 0) {
        alert("Please enter valid non-negative numbers.");
        return;
      }

      try {
        await setDoc(doc(db, "settings", "referralBonus"), { value: newBonus });
        await setDoc(doc(db, "settings", "minWithdraw"), { value: newMinWithdraw });
        await setDoc(doc(db, "settings", "minDeposit"), { value: newMinDeposit });

        document.getElementById("settingsStatus").textContent = "Settings updated successfully.";
      } catch (error) {
        console.error("Error updating settings:", error);
        document.getElementById("settingsStatus").textContent = "Failed to update settings.";
      }
    });
  });

  // Auth check and init
  onAuthStateChanged(auth, (user) => {
    if (user) {
      loadSettings();
    } else {
      document.getElementById("settingsStatus").textContent = "Please log in as admin.";
    }
  });
</script>
</body>
</html>
